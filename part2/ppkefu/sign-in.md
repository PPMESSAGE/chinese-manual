# 移动消息流程
移动消息流程功能和玩也消息流程极为相似，网页消息流程负责web端的信息处理，移动消息流程负责APP移动端的消息处理。

在指导流程前首先我们要明白消息流程的意义。
消息流程是 PPMESSAGE 消息系统的核心组件，消息流程通过响应消息渠道的事件，执行预定义的流程，每个流程由开始和结束节点以及中间的若干节点组成，节点执行数据处理或者指定的动作，返回执行的结果，通过对节点结果的处理就将引导流程走向下一个节点，使节点间形成连接关系，构成流程。

![](http://upload-images.jianshu.io/upload_images/12406336-2fe7fb0b5b417c8f?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

流程界面：

左边栏是流程列表，流程列表中的每一项都代表一个流程。每个流程有四个元素，状态指示，流程名称，流程类型，流程菜单。

状态指示指明这个流程是否是处于激活状态，流程名字用于标示流程，可以取同样的名字，因为系统内部并没有以名字区分，即使是同样的名字也可以是不同的流程，流程类型是指这个流程的类别，目前对于网站渠道的访客行为，PPMESSAGE 支持的流程类型有三种：

1.  客户加载聊天组件
2.  客户打开聊天组件
3.  客户发送消息

这里的每个时机都是单独的流程，需要配置。

节点属性：

通过 DRAG AND DROP （在 PC 系统上，MOBILE 还不支持）将工具栏上的节点放置于空白处，建立节点，单击节点，节点会处于选中的状态。一个选中状态的节点，四周会被 HIGHLIGHT，并且会出现一个3个点的图标按钮，点击这个按钮或者双击当前节点会换出节点属性页面。每个节点矩形由节点的标题，节点输入，节点输出组成，刚刚拖放下来的节点没有输入的指示，输入的指示在节点矩形的左侧，输出的指示在节点矩形的右侧，这个节点有两个输出结果，一个是 SUCCESS 一个是FAILED。

![](http://upload-images.jianshu.io/upload_images/12406336-67c49988bddc73d1?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

这是一个节点的属性，这个窗口可以通过双击节点弹出，也可以通过单击节点的右上角三个点表示的 ‘更多’ 按键实现。

![](http://upload-images.jianshu.io/upload_images/12406336-c87c41df3127e304?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

每个节点都有其特别的属性，但类别分为：

*   基本信息：节点名称，是否有超时设置
*   输入参数：可以是选择框有内置的选项供选择，可以文本框用来直接输入
*   输出结果：输出结果是指这个节点操作结束后，会产生一个结果数据，这个结果数据会保存在以输出结果命名的变量中
*   路径：路径是这个节点执行结果对应的下一个节点。

了解节点还有流程界面的元素后，下面说三个流程的具体配置。


聊天组件的加载：

在访客访问时，访客首先要进行聊天组建的加载，在这里可以设置流程完成一些定制操作。下面介绍一种简单例子，提供给用户参考。
如果觉得菜单栏还有流程列表影响配置流程可以将他们关闭。点击流程列表左上角的叉号即可，关闭菜单栏可以点击菜单栏右下角的小尖头即可。
首先流程都必须以开始节点开始，当访客加载组件时，要判断访客是否已经分配客服，需要将已经分配客服节点拖拽下来(箭头所示的节点)，开始节点连接分配座席节点，此时流程如下。

![](https://upload-images.jianshu.io/upload_images/12406336-fdd1012946eb6fc7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

然后将特效节点和分配座席组节点拖拽下来。双击已经分配座席进行节点连接的详细操作，双击后点击添加连接按钮，选择True,下一节点选择界面特效节点。点击对号按钮进行保存。再次点击添加连接按钮，节点执行按钮选择False，下一节点选择分配给座席组，点击对号保存即可。
然后双击分配给座席组节点进行配置，首先勾选输入参数（这里提供三种包括在线优先，要求座席在线，要求座席就绪。）选择完成后选择推送的座席组只能单选，然后选择分配方法，提供俩种随机分配或者分配给所有人，管理者可以自己选择。下一步点击添加链接，在节点执行结果上选择SUCCESS,下一节点选择界面特效即可。此时界面如下。

![](https://upload-images.jianshu.io/upload_images/12406336-a291d137666602fc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

然后拖拽设置颜色和设置背景俩个节点。
双击界面特效节点进行设置，特效参数提供
- 弹跳
- 弹跳入
- 弹跳入从上向下
- 弹跳入从下到上
- 弹跳入从左到右
- 弹跳入从右到左
- 弹跳出
- 弹跳出从上到下
- 弹跳出从下到上
- 弹跳出从左到右
- 弹跳出从右到左
- 淡入
- 淡入从上到下
- 淡入从上到下大幅度
- 淡入从左到右 
- 淡入从左到右大幅度
- 淡入从上到下大幅度
- 淡入从上到下大幅度
- 淡出
- 淡出向下
- 淡出向左 
- 淡出向右
- 淡出向上
- 闪烁
- 翻转
- 摇头
- 定点转动
- 凝聚
- 缩小出
等等特效，选择一个特效后，即自动保存。
在点击添加连接，节点执行结果选择SUCCESS，下一节点选择设置颜色点击下方对号保存添加连接设置。
双击设置颜色节点，在输入参数中双击文本框就会弹出调色板自主选择颜色即可，点击右下角Select保存，在点击添加连接按钮，节点执行结果选择SUEECSS,下一节点选择设置背景节点即可。此时界面如下。

![](https://upload-images.jianshu.io/upload_images/12406336-9e0a61b88a700ea2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

最后拖拽设置恢复时间节点和结束节点。
双击设置背景节点，选择一个背景图(目前只有四种背景，还在创作中)，添加连接，在节点执行结果选择SUCCESS，下一节点选择预测设置回复时间，点击保存即可。
在双击设置恢复时间节点，进行配置在输入参数一栏中计算方法推荐选择系统自动，然后添加连接设置上节点执行结果选择SUCCESS，下一节点选择结束。一个基本的访客加载流程就配好了。此时界面如下。

![](https://upload-images.jianshu.io/upload_images/12406336-cfb6bea721eb133d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

客户打开组件：

当客户打开聊天组件时，可以配置一个流程引导客户进行提问，这样操作有助于访客了解商品。
管理者通过【设置-移动消息流程】进入界面。在设置客户打开消息流程中首先将开始节点，预测问题节点拖拽下来。

![](https://upload-images.jianshu.io/upload_images/12406336-694bb787d6daa1d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

然后双击开始节点，选择SUCCESS节点执行结果，下一个节点选择预测问题。然后将以座席回复消息节点和结束节点拖拽下来。在预测问题节点的详细设置中，选择SUCCESS执行结锅，下一个节点选择以座席回复消息。
在以座席回复消息节点中

![](https://upload-images.jianshu.io/upload_images/12406336-e520463a28de5b48.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

这样配置就好，也可以根据自己需要选择其他消息来源。
接下来连接结束节点即可。
想填入的预测问题，请在【设置-智能问答】中填写问题和答案。最后流程如下

![](https://upload-images.jianshu.io/upload_images/12406336-3c13c786c19f98c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

客户发送消息：

客户发送消息流程，在 PPMESSAGE 中管理者可以设置客户发送消息流程，这有助于回答访客问题，也能对预测问题进行回答。
具体操作如下。
客户首先通过【设置-网页消息流程】进入界面，将开始节点，预测答案节点都拖拽下来然后双击开始节点，节点执行结果选择SUCCESS，下一个节点选择预测答案节点。然后将座席离线节点，给客服发送微信模版消息节点，以座席用户回复都拖拽下来。
然后点击预测答案节点在这里预测消息来源勾选文本，座席人员按照需要选择即可，然后添加连接，HAS_ANSWER执行结果下一个节点选择离线节点，NO_ANSWER执行结果下一个节点也选择选择离线节点。
双击座席离线节点这里的连接中TRUE执行结果下一个节点为给客服发送微信模版消息，FALSE执行结果下一个节点为以座席用户回复消息。
接下来，给客服发送模版消息和以座席用户回复消息的SUCCESS执行结果的徐阿姨个连接都选择结束节点。流程配置如下。

![](https://upload-images.jianshu.io/upload_images/12406336-072a7f23b2676ae9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

将三个时机的流程都配置好了之后在流程列表中启动。就能正常的使用网页消息了。如果您有特殊的网页消息功能需求比如希望，有一些自动回答或者主动欢迎，都能在流程中配置，请在教程中搜索更多流程配置。





