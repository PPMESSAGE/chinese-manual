# 短信消息流程
PPMESSAGE 集成短消息的收发功能，客户发送的短消息可以通过 PPMESSAGE 的消息流程系统转发至座席。座席也可以直接在对话界面给客户回复短消息，座席也可以给离线的客户通过短消息留言。

在 PPMESSAGE 中实现短消息收发和邮件收发的方法是一样的。都是通过集成第三方服务完成，PPMESSAGE 本身并不收取任何短消息的费用。只是将短消息集成到 PPMESSAGE 的整个消息系统之中。

PPMESSAGE 能够通过这些离线通讯手段，短消息、电子邮件、移动应用消息推送、电话外呼，设计自动流程，自动的流程的启动时机是系统根据设定调度的，不是根据用户事件触发；一般来说靠定时驱动，比如您可以设定一个自动流程，这个自动流程每隔1小时运行一次，每次都对一个用户细分进行消息发送。当然在实际情况中，可能是1天检查运行，或者是一个月运行一次，因为毕竟客户离你而去是有原因的，频繁的骚扰只会带来更远的距离和更坚决的拒绝。

回到短消息使用方法上，目前 PPMESSAGE 集成了 Twilio 和阿里云的短消息服务，因为 Twilio 和阿里云能够做到发送和接收同时支持，如 Mailgun 一样，Mailgun 也同时支持邮件的接收与发送。



这里略去 Twilio 或阿里云短信的服务配置，如果有需要知道的朋友可以通过在线客服联系我们。这里以 Twilio 为例，讲解下配置服务。

拿到 Twilio 的配置信息后，开始 PPMESSAGE 的后台设置。

设置 - 第三方服务 - 短信服务：

![image](http://upload-images.jianshu.io/upload_images/12406336-828c47c03d082423?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

这里面隐去了 PPMESSAGE 真实的配置信息，那些信息都是从 Twilio 的网站后台获取的。

最后一项是接收客户短消息，如果选中了，那么这个 URL 是需要提供给 Twilio 的，这是 PPMESSAGE 为您专门准备的 WEB 服务，这样 Twilio 收到短消息的时候就会同时发送一个请求给这个 URL，这样 PPMESSAGE 就能够收到客户的短消息了。

还有最后一步，就是流程，PPMESSAGE 本身是一个流程驱动的系统，当客户短消息来临，相当于触发了 PPMESSAGE 的一个事件，这个事件导致一个流程的执行，而这个流程是可以定制的，根据您的具体要求可以在消息来临后决定执行什么操作。

下面是 PPMESSAGE 自己的流程配置，仅供参考。
管理者首先在流程列表的选项中点击添加流程，按照要求填写流程启动时机和流程名称，点击对号创建新的短信流程。创建好的流程会在流程列表中出现。
双击流程所在位置进行流程的详细配置。这里可以点击粉色框中的叉号将流程列表关掉，来专心配置短信流程。这里简单演示一个短信流程，管理者可以根据自己需要进行定制。
首先将开始节点和获取客户数据节点拖拽下来，双击开始节点，在添加连接中 SUCCESS 结果的下一个节点选择获取客户数据。

接下来将已经分配座席节点和分配给全体座席人员节点，分配给制定座席人员节点拖拽下来。双击获取客户数据节点中添加连接功能里，SUCCESS 执行结果下一个节点选择已经分配座席节点。
此时界面如下。

![](https://upload-images.jianshu.io/upload_images/12406336-d6d1b9c745b9b808.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

双击已经分配座席人员节点，在该节点中添加连接时 True 节点执行结果选择分配指定座席人员节点，Flase 节点选择分配全体座席人员。这样就能将短息发送给访客对应的座席人员了，如果为第一次的访客那么会发给所有座席人员。下面将消息转化节点，结束节点都_拖拽_下来。
在分配指定座席人员节点中，输入参数一栏选择该访客对应的座席人员即可。添加连接中 SUCCESS 执行结果 下一个执行节点选择消息转化节点。
分配给全体座席人员节点中 SUCCESS 执行结果 下一个执行节点选择消息转化节点。
在消息转换节点中输入参数选择邮件，添加连接时 SUCCESS 执行结果 下一个执行节点选择结束节点。然后在流程列表中启动流程即可(启动方法如下，点击箭头所示位置选择开始流程即可)。

![](https://upload-images.jianshu.io/upload_images/12406336-de2ee99762370dd3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


整个流程配置如下 。

![](https://upload-images.jianshu.io/upload_images/12406336-e1e2ab80822f02db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

这样一个完整的短信服务就配置好了。


